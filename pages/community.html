<!DOCTYPE html>
<html lang="ko" data-theme="heritage">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>교환독서 – 커뮤니티</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .quiz{display:grid;gap:.8rem}
    .quiz .q{font-weight:700}
    .quiz .choices{display:grid;gap:.4rem}
    .badge{display:inline-flex;align-items:center;gap:.35rem;background:color-mix(in oklab,var(--accent) 55%, white);border:1px solid color-mix(in oklab,var(--accent) 80%, var(--paper));border-radius:999px;padding:.25rem .6rem}
    .news li{margin:.35rem 0}
    .events li{margin:.35rem 0}
  </style>
</head>
<body>
  <a href="#main" class="sr-only">본문으로 건너뛰기</a>
  <header class="site-header">
    <a class="logo" href="../index.html">교환독서</a>
    <nav aria-label="주요">
      <ul class="gnb">
        <li><a href="../index.html">홈</a></li>
        <li><a href="schedule.html">일정</a></li>
        <li><a href="library.html">도서관</a></li>
        <li><a aria-current="page" href="community.html">커뮤니티</a></li>
      </ul>
    </nav>
  </header>
  <main id="main">
    <h1>커뮤니티</h1>

    <section class="panel">
      <h2>독서 퀴즈</h2>
      <div class="quiz" id="quiz"></div>
      <div id="quizResult" class="muted"></div>
      <div style="margin-top:.6rem"><button class="btn" id="quizStart">퀴즈 시작/다시하기</button></div>
    </section>

    <section class="panel">
      <h2>요즘 뜨는 책</h2>
      <div id="trending" class="card-grid"></div>
    </section>

    <section class="panel">
      <h2>독서 뉴스</h2>
      <ul class="news" id="news"></ul>
    </section>

    <section class="panel">
      <h2>이벤트</h2>
      <ul class="events" id="events"></ul>
    </section>

    <nav class="page-nav" aria-label="페이지 네비게이션">
      <a href="../index.html" class="page-link"><span class="page-number">1</span></a>
      <a href="schedule.html" class="page-link"><span class="page-number">2</span></a>
      <a href="library.html" class="page-link"><span class="page-number">3</span></a>
    </nav>
  </main>
  <footer class="site-footer">
    <small>© 2025 ExchangeBook</small>
  </footer>

  <script src="../js/bookData.js"></script>
  <script>
    // 간단한 퀴즈
    const QUESTIONS = [
      { q: '다음 중 단편 소설집은?', c: ['지뢰 글리코', '바깥은 여름', '지구끝의 온실'], a: 1 },
      { q: '김초엽 작가는 어떤 장르로 유명할까요?', c: ['추리', 'SF', '에세이'], a: 1 },
      { q: '교환독서의 취지와 가장 가까운 것은?', c: ['책을 모아 전시한다', '서로 책을 교환하며 읽는다', '오로지 전자책만 읽는다'], a: 1 }
    ];

    const quizEl = document.getElementById('quiz');
    const quizResult = document.getElementById('quizResult');
    const startBtn = document.getElementById('quizStart');

    function renderQuiz(){
      quizEl.innerHTML = QUESTIONS.map((item, idx) => `
        <div>
          <div class="q">Q${idx+1}. ${item.q}</div>
          <div class="choices">
            ${item.c.map((choice, cidx)=>`
              <label class="card" style="display:flex;align-items:center;gap:.5rem">
                <input type="radio" name="q${idx}" value="${cidx}"> ${choice}
              </label>
            `).join('')}
          </div>
        </div>
      `).join('');
      quizResult.textContent = '';
    }

    function grade(){
      let score = 0;
      QUESTIONS.forEach((item, idx) => {
        const sel = document.querySelector(`input[name="q${idx}"]:checked`);
        if(sel && Number(sel.value) === item.a) score++;
      });
      quizResult.textContent = `점수: ${score} / ${QUESTIONS.length}`;
      localStorage.setItem('quiz_score', String(score));
    }

    startBtn.addEventListener('click', () => {
      renderQuiz();
    });

    quizEl.addEventListener('change', () => {
      grade();
    });

    // 트렌딩: 별점 상위 3개 (데이터 + 로컬 리뷰 기반)
    function topTrending(n=3){
      const enriched = books.map(b => ({...b, avg: computeAverageRating(b)}));
      enriched.sort((a,b) => (b.avg||0) - (a.avg||0));
      return enriched.slice(0,n);
    }

    const trendingEl = document.getElementById('trending');
    function renderTrending(){
      const list = topTrending(3);
      trendingEl.innerHTML = list.map(b => `
        <article class="card" style="cursor:pointer" onclick="location.href='book-detail.html?id=${b.id}'">
          <div class="book-meta" style="margin-bottom:.4rem">
            <strong>${b.title}</strong>
            <span class="badge">★ ${computeAverageRating(b) || '0.0'}</span>
          </div>
          <div class="muted">${b.author}</div>
        </article>
      `).join('');
    }

    // 뉴스/이벤트 (하드코딩 데모)
    const newsEl = document.getElementById('news');
    const eventsEl = document.getElementById('events');
    function renderNews(){
      const items = [
        '올해의 책 후보 공개 – 다양한 장르의 작품들이 경쟁',
        '독서 주간 맞이 전국 도서관 행사 풍성',
        '신간 알림: 화제의 작가 신작 출간'
      ];
      newsEl.innerHTML = items.map(t => `<li>• ${t}</li>`).join('');
    }
    function renderEvents(){
      const items = [
        '11/10(월) 온라인 북토크 – 우리는 왜 책을 돌려 읽을까',
        '11/23(토) 교환독서 번개 – 가벼운 책 한 권과 함께',
        '12/05(금) 올해 결산 모임 – 베스트 리뷰 시상'
      ];
      eventsEl.innerHTML = items.map(t => `<li>• ${t}</li>`).join('');
    }

    // 초기 렌더
    renderQuiz();
    renderTrending();
    renderNews();
    renderEvents();
  </script>
</body>
</html>
