<!DOCTYPE html>
<html lang="ko" data-theme="heritage">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>êµí™˜ë…ì„œ â€“ ì»¤ë®¤ë‹ˆí‹°</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .quiz{display:grid;gap:.8rem}
    .quiz .q{font-weight:700}
    .quiz .choices{display:grid;gap:.4rem}
    .badge{display:inline-flex;align-items:center;gap:.35rem;background:color-mix(in oklab,var(--accent) 55%, white);border:1px solid color-mix(in oklab,var(--accent) 80%, var(--paper));border-radius:999px;padding:.25rem .6rem}
    .news li{margin:.35rem 0}
    .events li{margin:.35rem 0}
  </style>
</head>
<body>
  <a href="#main" class="sr-only">ë³¸ë¬¸ìœ¼ë¡œ ê±´ë„ˆë›°ê¸°</a>
  <header class="site-header">
    <a class="logo" href="../index.html">êµí™˜ë…ì„œ</a>
    <nav aria-label="ì£¼ìš”">
      <ul class="gnb">
        <li><a href="../index.html">í™ˆ</a></li>
        <li><a href="schedule.html">ì¼ì •</a></li>
        <li><a href="library.html">ë„ì„œê´€</a></li>
          <li><a aria-current="page" href="community.html">ì»¤ë®¤ë‹ˆí‹°</a></li>
          <li><a href="myspace.html">ë‚´ ê³µê°„</a></li>
      </ul>
    </nav>
  </header>
  <main id="main">
    <h1>ì»¤ë®¤ë‹ˆí‹°</h1>
    
    <section class="panel">
      <h2>ğŸ“š ëœë¤ ì±… ë½‘ê¸°</h2>
      <p class="muted">ì˜¤ëŠ˜ ì½ì„ ì±…ì„ ëœë¤ìœ¼ë¡œ ì¶”ì²œë°›ì•„ë³´ì„¸ìš”!</p>
      <div style="margin-top:1rem;text-align:center">
        <button class="btn" id="randomBtn" style="font-size:1.1rem;padding:.8rem 1.5rem">ğŸ² ì±… ë½‘ê¸°</button>
      </div>
      <div id="randomResult" style="margin-top:1rem"></div>
    </section>

    <section class="panel">
      <h2>ë…ì„œ í€´ì¦ˆ</h2>
      <div class="quiz" id="quiz"></div>
      <div id="quizResult" class="muted"></div>
      <div style="margin-top:.6rem"><button class="btn" id="quizStart">í€´ì¦ˆ ì‹œì‘/ë‹¤ì‹œí•˜ê¸°</button></div>
      
      <!-- ë¦¬ë”ë³´ë“œ -->
      <div style="margin-top:1.5rem;border-top:1px solid var(--line);padding-top:1rem">
        <h3 style="margin:0 0 .5rem 0">ë‚´ ê¸°ë¡</h3>
        <div id="leaderboard"></div>
      </div>
    </section>

    <section class="panel">
      <h2>ìš”ì¦˜ ëœ¨ëŠ” ì±…</h2>
      <div id="trending" class="card-grid"></div>
    </section>

    <section class="panel">
      <h2>ë…ì„œ ë‰´ìŠ¤</h2>
      <ul class="news" id="news"></ul>
    </section>

    <nav class="page-nav" aria-label="í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜">
      <a href="../index.html" class="page-link"><span class="page-number">1</span></a>
      <a href="schedule.html" class="page-link"><span class="page-number">2</span></a>
      <a href="library.html" class="page-link"><span class="page-number">3</span></a>
    </nav>
  </main>
  <footer class="site-footer">
    <small>Â© 2025 ExchangeBook</small>
  </footer>

  <script src="../js/bookData.js"></script>
  <script>
    // ëœë¤ ì±… ë½‘ê¸°
    document.getElementById('randomBtn').addEventListener('click', () => {
      const rnd = books[Math.floor(Math.random() * books.length)];
      const avg = computeAverageRating(rnd);
      document.getElementById('randomResult').innerHTML = `
        <div class="card" style="cursor:pointer;text-align:center" onclick="location.href='book-detail.html?id=${rnd.id}'">
          <h3 style="margin:.3rem 0">${rnd.title}</h3>
          <p class="muted">${rnd.author}</p>
          <div style="margin-top:.3rem">â˜… ${avg||'0.0'}</div>
          <button class="btn" style="margin-top:.6rem">ìƒì„¸ ë³´ê¸°</button>
        </div>
      `;
    });
    
    // ê°„ë‹¨í•œ í€´ì¦ˆ
    const QUESTIONS = [
      { q: 'ë‹¤ìŒ ì¤‘ ë‹¨í¸ ì†Œì„¤ì§‘ì€?', c: ['ì§€ë¢° ê¸€ë¦¬ì½”', 'ë°”ê¹¥ì€ ì—¬ë¦„', 'ì§€êµ¬ëì˜ ì˜¨ì‹¤'], a: 1 },
      { q: 'ê¹€ì´ˆì—½ ì‘ê°€ëŠ” ì–´ë–¤ ì¥ë¥´ë¡œ ìœ ëª…í• ê¹Œìš”?', c: ['ì¶”ë¦¬', 'SF', 'ì—ì„¸ì´'], a: 1 },
      { q: 'êµí™˜ë…ì„œì˜ ì·¨ì§€ì™€ ê°€ì¥ ê°€ê¹Œìš´ ê²ƒì€?', c: ['ì±…ì„ ëª¨ì•„ ì „ì‹œí•œë‹¤', 'ì„œë¡œ ì±…ì„ êµí™˜í•˜ë©° ì½ëŠ”ë‹¤', 'ì˜¤ë¡œì§€ ì „ìì±…ë§Œ ì½ëŠ”ë‹¤'], a: 1 }
    ];

    const quizEl = document.getElementById('quiz');
    const quizResult = document.getElementById('quizResult');
    const startBtn = document.getElementById('quizStart');

    function renderQuiz(){
      quizEl.innerHTML = QUESTIONS.map((item, idx) => `
        <div>
          <div class="q">Q${idx+1}. ${item.q}</div>
          <div class="choices">
            ${item.c.map((choice, cidx)=>`
              <label class="card" style="display:flex;align-items:center;gap:.5rem">
                <input type="radio" name="q${idx}" value="${cidx}"> ${choice}
              </label>
            `).join('')}
          </div>
        </div>
      `).join('');
      quizResult.textContent = '';
    }

    function grade(){
      let score = 0;
      QUESTIONS.forEach((item, idx) => {
        const sel = document.querySelector(`input[name="q${idx}"]:checked`);
        if(sel && Number(sel.value) === item.a) score++;
      });
      quizResult.textContent = `ì ìˆ˜: ${score} / ${QUESTIONS.length}`;
      
      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ê¸°ë¡ ì €ì¥
      const history = getQuizHistory();
      const today = new Date().toISOString().split('T')[0];
      history.push({ date: today, score });
      localStorage.setItem('quiz_history', JSON.stringify(history.slice(-10))); // ìµœê·¼ 10ê°œë§Œ
      renderLeaderboard();
    }

    function getQuizHistory(){
      try{
        return JSON.parse(localStorage.getItem('quiz_history')||'[]');
      }catch{return []}
    }
    
    function renderLeaderboard(){
      const history = getQuizHistory();
      const el = document.getElementById('leaderboard');
      if(!history.length){
        el.innerHTML = '<p class="muted">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”.</p>';
        return;
      }
      const sorted = history.slice().sort((a,b) => b.score - a.score);
      el.innerHTML = `
        <div style="font-size:.9rem">
          <div style="display:grid;grid-template-columns:1fr auto;gap:.3rem">
            ${sorted.slice(0,5).map((r,i) => `
              <div>${i+1}. ${r.date}</div>
              <div><strong>${r.score}ì </strong></div>
            `).join('')}
          </div>
        </div>
      `;
    }

    startBtn.addEventListener('click', () => {
      renderQuiz();
    });

    quizEl.addEventListener('change', () => {
      grade();
    });

    // íŠ¸ë Œë”©: ë³„ì  ìƒìœ„ 3ê°œ (ë°ì´í„° + ë¡œì»¬ ë¦¬ë·° ê¸°ë°˜)
    function topTrending(n=3){
      const enriched = books.map(b => ({...b, avg: computeAverageRating(b)}));
      enriched.sort((a,b) => (b.avg||0) - (a.avg||0));
      return enriched.slice(0,n);
    }

    const trendingEl = document.getElementById('trending');
    function renderTrending(){
      const list = topTrending(3);
      trendingEl.innerHTML = list.map(b => `
        <article class="card" style="cursor:pointer" onclick="location.href='book-detail.html?id=${b.id}'">
          <div class="book-meta" style="margin-bottom:.4rem">
            <strong>${b.title}</strong>
            <span class="badge">â˜… ${computeAverageRating(b) || '0.0'}</span>
          </div>
          <div class="muted">${b.author}</div>
        </article>
      `).join('');
    }

    // ë‰´ìŠ¤ (í•˜ë“œì½”ë”© ë°ëª¨)
    const newsEl = document.getElementById('news');
    function renderNews(){
      const items = [
        'ì˜¬í•´ì˜ ì±… í›„ë³´ ê³µê°œ â€“ ë‹¤ì–‘í•œ ì¥ë¥´ì˜ ì‘í’ˆë“¤ì´ ê²½ìŸ',
        'ë…ì„œ ì£¼ê°„ ë§ì´ ì „êµ­ ë„ì„œê´€ í–‰ì‚¬ í’ì„±',
        'ì‹ ê°„ ì•Œë¦¼: í™”ì œì˜ ì‘ê°€ ì‹ ì‘ ì¶œê°„'
      ];
      newsEl.innerHTML = items.map(t => `<li>â€¢ ${t}</li>`).join('');
    }

    // ì´ˆê¸° ë Œë”
    renderQuiz();
    renderTrending();
    renderNews();
    renderLeaderboard();
  </script>
</body>
</html>
