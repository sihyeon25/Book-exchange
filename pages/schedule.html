<!--
  ====================================
  SCHEDULE PAGE
  일정 관리 페이지
  ====================================
  
  페이지 기능:
  1. 2차 교환독서 일정 표시
  2. 사람별 필터링
  3. 월별 슬라이드 네비게이션
  4. 달력 표시 (오늘 날짜 하이라이트)
  5. 일정 조율 도구
  
  특징:
  - 멤버별 색상 시스템
  - 반응형 테이블
  - 스크롤 비헤이비어 최적화
-->
<!DOCTYPE html>
<html lang="ko" data-theme="heritage">
<head>
  <!-- ====================================
       META & COMPATIBILITY SETUP
       기본 메타 정보 및 호환성 설정
  ===================================== -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=5.0,user-scalable=yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#2C3E50">
  <meta name="msapplication-TileColor" content="#2C3E50">
  <title>교환독서 – 일정</title>
  
  <!-- Google Fonts: Nanum Myeongjo (나눔명조) 로딩 최적화 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap" rel="stylesheet">
  
  <!-- 외부 스타일시트 (상위 폴더에서 참조) -->
  <link rel="stylesheet" href="../css/style.css">
</head>
<body class="subpage" data-page="schedule">
  <!-- Skip link for accessibility -->
  <a href="#main" class="sr-only">본문으로 건너뛰기</a>
  
  <!-- ============================================
       HEADER
       상단 고정 헤더: 로고 + 네비게이션
  ============================================= -->
  <header class="site-header is-solid">
    <a class="logo" href="../index.html">교환독서</a>
    <nav aria-label="주요">
      <ul class="gnb">
        <li><a href="../index.html?from=internal">홈</a></li>
        <li><a aria-current="page" href="schedule.html">일정</a></li>
        <li><a href="library.html">도서관</a></li>
        <li><a href="community.html">게시판</a></li>
      </ul>
    </nav>
  </header>

  <!-- ============================================
       MAIN CONTENT
       일정 페이지 메인 콘텐츠
  ============================================= -->
  <main id="main">
    <h1>< 일정 ></h1>

    <!-- 탭 네비게이션: 진행중 / 지난 회차 -->
    <div class="schedule-tabs">
      <a href="#person-filter" class="tab-btn active">진행중</a>
      <a href="#past" class="tab-btn">지난 회차</a>
    </div>

    <!-- 사람별 필터 -->
    <div class="person-filter" id="person-filter" style="margin-top:4rem">
      <button class="filter-btn active" data-person="all">전체</button>
      <button class="filter-btn" data-person="시현">시현</button>
      <button class="filter-btn" data-person="태이">태이</button>
      <button class="filter-btn" data-person="희수">희수</button>
      <button class="filter-btn" data-person="지원">지원</button>
    </div>

    <!-- ============================================
         ONGOING SECTION
         현재 진행중인 2차 회차 일정 - 월별 슬라이드
    ============================================= -->
    <section id="ongoing" class="panel">
      <h2>2차 (10–4월)</h2>
      
      <!-- 월별 네비게이션 -->
      <div class="month-nav" style="display:flex;align-items:center;justify-content:center;gap:1rem;margin:1.5rem 0">
        <button id="prevMonth" class="btn ghost month-nav-btn" style="padding:.5rem 1rem">← 이전 달</button>
        <h3 id="currentMonth" style="margin:0;min-width:120px;text-align:center;color:#2C3E50">12–1월</h3>
        <button id="nextMonth" class="btn ghost month-nav-btn" style="padding:.5rem 1rem">다음 달 →</button>
      </div>
      
      <!-- 월별 테이블 컨테이너 -->
      <div class="table-wrapper" style="overflow:hidden">
        <div id="scheduleSlider" style="display:flex;transition:transform 0.3s ease">
          
          <!-- 10-11월 슬라이드 -->
          <div class="schedule-slide" style="min-width:100%;flex-shrink:0;padding:0 0.5rem">
            <table class="table" aria-label="10-11월 일정">
              <thead>
                <tr>
                  <th scope="col" style="width:8rem">기간</th>
                  <th scope="col">책 제목</th>
                  <th scope="col" style="width:8rem">담당</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>10–11월</td><td>지뢰 글리코</td><td data-person="태이">태이</td></tr>
                <tr><td>10–11월</td><td>일억 번째 여름</td><td data-person="희수">희수</td></tr>
                <tr><td>10–11월</td><td>바깥은 여름</td><td data-person="시현">시현</td></tr>
                <tr><td>10–11월</td><td>다정한 사람이 이긴다</td><td data-person="지원">지원</td></tr>
              </tbody>
            </table>
          </div>
          
          <!-- 12-1월 슬라이드 -->
          <div class="schedule-slide" style="min-width:100%;flex-shrink:0;padding:0 0.5rem">
            <table class="table" aria-label="12-1월 일정">
              <thead>
                <tr>
                  <th scope="col" style="width:8rem">기간</th>
                  <th scope="col">책 제목</th>
                  <th scope="col" style="width:8rem">담당</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>12–1월</td><td>지뢰 글리코</td><td data-person="희수">희수</td></tr>
                <tr><td>12–1월</td><td>일억 번째 여름</td><td data-person="시현">시현</td></tr>
                <tr><td>12–1월</td><td>바깥은 여름</td><td data-person="지원">지원</td></tr>
                <tr><td>12–1월</td><td>다정한 사람이 이긴다</td><td data-person="태이">태이</td></tr>
              </tbody>
            </table>
          </div>
          
          <!-- 2월 슬라이드 -->
          <div class="schedule-slide" style="min-width:100%;flex-shrink:0;padding:0 0.5rem">
            <table class="table" aria-label="2월 일정">
              <thead>
                <tr>
                  <th scope="col" style="width:8rem">기간</th>
                  <th scope="col">책 제목</th>
                  <th scope="col" style="width:8rem">담당</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>2월</td><td>지뢰 글리코</td><td data-person="시현">시현</td></tr>
                <tr><td>2월</td><td>일억 번째 여름</td><td data-person="지원">지원</td></tr>
                <tr><td>2월</td><td>바깥은 여름</td><td data-person="태이">태이</td></tr>
                <tr><td>2월</td><td>다정한 사람이 이긴다</td><td data-person="희수">희수</td></tr>
              </tbody>
            </table>
          </div>
          
          <!-- 3-4월 슬라이드 -->
          <div class="schedule-slide" style="min-width:100%;flex-shrink:0;padding:0 0.5rem">
            <table class="table" aria-label="3-4월 일정">
              <thead>
                <tr>
                  <th scope="col" style="width:8rem">기간</th>
                  <th scope="col">책 제목</th>
                  <th scope="col" style="width:8rem">담당</th>
                </tr>
              </thead>
              <tbody>
                <tr><td>3–4월</td><td>지뢰 글리코</td><td data-person="지원">지원</td></tr>
                <tr><td>3–4월</td><td>일억 번째 여름</td><td data-person="태이">태이</td></tr>
                <tr><td>3–4월</td><td>바깥은 여름</td><td data-person="희수">희수</td></tr>
                <tr><td>3–4월</td><td>다정한 사람이 이긴다</td><td data-person="시현">시현</td></tr>
              </tbody>
            </table>
          </div>
          
        </div>
      </div>
      
      <p class="muted" style="margin-top:1rem">진행중 일정은 변동될 수 있어요.</p>
    </section>

    <!-- ============================================
         PAST SECTION
         완료된 1차 회차 일정
    ============================================= -->
    <div class="schedule-tabs" style="margin-top:4rem">
      <a href="#person-filter" class="tab-btn">진행중</a>
      <a href="#past" class="tab-btn active">지난 회차</a>
    </div>
    
    <section id="past" class="panel">
      <h2>1차 (4–8월)</h2>
      
      <!-- 일정 테이블: 기간 / 제목 / 담당자 -->
      <div class="table-wrapper">
        <table class="table table-3books" aria-label="1차 회차 기록">
        <thead>
          <tr>
            <th scope="col" style="width:8rem">기간</th>
            <th scope="col">책 제목</th>
            <th scope="col" style="width:8rem">담당</th>
          </tr>
        </thead>
        <tbody>
          <!-- 4-5월: 첫 번째 기간 (3권) -->
          <tr><td>4–5월</td><td>궤도의 밖에서, 나의 룸메이트에게</td><td data-person="희수">희수</td></tr>
          <tr><td>4–5월</td><td>지구끝의 온실</td><td data-person="태이">태이</td></tr>
          <tr class="period-end"><td>4–5월</td><td>여름</td><td data-person="시현">시현</td></tr>

          <!-- 6월: 두 번째 기간 (3권 교환) -->
          <tr><td>6월</td><td>궤도의 밖에서, 나의 룸메이트에게</td><td data-person="시현">시현</td></tr>
          <tr><td>6월</td><td>지구끝의 온실</td><td data-person="희수">희수</td></tr>
          <tr class="period-end"><td>6월</td><td>여름</td><td data-person="태이">태이</td></tr>

          <!-- 7-8월: 세 번째 기간 (3권 교환) -->
          <tr><td>7–8월</td><td>궤도의 밖에서, 나의 룸메이트에게</td><td data-person="태이">태이</td></tr>
          <tr><td>7–8월</td><td>지구끝의 온실</td><td data-person="시현">시현</td></tr>
          <tr class="period-end"><td>7–8월</td><td>여름</td><td data-person="희수">희수</td></tr>
        </tbody>
      </table>
      </div>
    </section>
    
    <!-- 달력 -->
    <section class="panel" style="margin-top:4rem">
      <h2>📅 달력</h2>
      
      <!-- 월 선택 -->
      <div style="display:flex;align-items:center;justify-content:center;gap:1rem;margin:1.5rem 0">
        <button id="prevCalMonth" class="btn ghost" style="padding:.5rem 1rem">← 이전 달</button>
        <h3 id="currentCalMonth" style="margin:0;min-width:120px;text-align:center;color:#2C3E50">2025년 12월</h3>
        <button id="nextCalMonth" class="btn ghost" style="padding:.5rem 1rem">다음 달 →</button>
      </div>
      
      <!-- 달력 그리드 -->
      <div id="calendarGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:.5rem;margin-top:1rem">
        <!-- 요일 헤더 -->
        <div style="text-align:center;font-weight:700;padding:.5rem;color:#e74c3c">일</div>
        <div style="text-align:center;font-weight:700;padding:.5rem">월</div>
        <div style="text-align:center;font-weight:700;padding:.5rem">화</div>
        <div style="text-align:center;font-weight:700;padding:.5rem">수</div>
        <div style="text-align:center;font-weight:700;padding:.5rem">목</div>
        <div style="text-align:center;font-weight:700;padding:.5rem">금</div>
        <div style="text-align:center;font-weight:700;padding:.5rem;color:#3498db">토</div>
      </div>
    </section>
    
    <!-- 일정 조율 도구 (축소 버전) -->
    <section class="panel" style="margin-top:2rem;padding:1.5rem;background:var(--bg-secondary)">
      <details>
        <summary style="cursor:pointer;font-weight:700;font-size:1rem;color:var(--primary)">📋 일정 조율 도구</summary>
        <div style="margin-top:1rem">
          <p class="muted" style="font-size:.9rem">모일 수 있는 날짜를 선택하고 친구와 공유해서 교집합을 찾아보세요.</p>
          
          <div style="margin-top:1rem">
            <label style="display:block;margin-bottom:.4rem;font-weight:700;font-size:.9rem">내가 가능한 날짜 선택</label>
            <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:.4rem" id="dateGrid"></div>
          </div>
          
          <div style="margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn" id="exportBtn" style="font-size:.9rem;padding:.4rem .8rem">내 코드 복사</button>
            <button class="btn ghost" id="importBtn" style="font-size:.9rem;padding:.4rem .8rem">친구 코드 추가</button>
            <button class="btn" id="findCommonBtn" style="font-size:.9rem;padding:.4rem .8rem;background:#27ae60">교집합 찾기</button>
          </div>
          
          <div id="codeListArea" style="margin-top:1rem;font-size:.9rem"></div>
          <div id="resultArea" style="margin-top:1rem;font-size:.9rem"></div>
        </div>
      </details>
    </section>

  </main>

  <!-- ============================================
       FOOTER
       하단 푸터
  ============================================= -->
  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="about.html">About</a>
        <span class="footer-divider">·</span>
        <a href="https://github.com/sihyeon25/Book-exchange" target="_blank" rel="noopener noreferrer">GitHub</a>
        <span class="footer-divider">·</span>
        <a href="mailto:sihyeon25@naver.com">Contact</a>
      </div>
      <small>© 2025 교환독서. All rights reserved.</small>
    </div>
  </footer>
  
  <script src="../js/schedule-tool.js"></script>
  
  <!-- 달력 기능 -->
  <script>
    (() => {
      const calendarGrid = document.getElementById('calendarGrid');
      const monthLabel = document.getElementById('currentCalMonth');
      const prevBtn = document.getElementById('prevCalMonth');
      const nextBtn = document.getElementById('nextCalMonth');
      
      const today = new Date();
      let currentYear = today.getFullYear();
      let currentMonth = today.getMonth();
      
      function renderCalendar() {
        // 요일 헤더 이후의 모든 날짜 셀 제거
        while (calendarGrid.children.length > 7) {
          calendarGrid.removeChild(calendarGrid.lastChild);
        }
        
        // 월 표시 업데이트
        monthLabel.textContent = `${currentYear}년 ${currentMonth + 1}월`;
        
        // 해당 월의 첫날과 마지막 날
        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startDayOfWeek = firstDay.getDay(); // 0 = Sunday
        
        // 빈 칸 추가 (첫 주의 빈 날짜들)
        for (let i = 0; i < startDayOfWeek; i++) {
          const emptyCell = document.createElement('div');
          calendarGrid.appendChild(emptyCell);
        }
        
        // 날짜 셀 추가
        for (let day = 1; day <= daysInMonth; day++) {
          const dayCell = document.createElement('div');
          dayCell.textContent = day;
          dayCell.style.cssText = `
            text-align:center;
            padding:.8rem;
            border:1px solid #ddd;
            border-radius:.5rem;
            cursor:pointer;
            transition:all .2s ease;
            background:#fff;
          `;
          
          const dayOfWeek = (startDayOfWeek + day - 1) % 7;
          if (dayOfWeek === 0) dayCell.style.color = '#e74c3c'; // 일요일
          if (dayOfWeek === 6) dayCell.style.color = '#3498db'; // 토요일
          
          // 오늘 날짜 강조
          const isToday = currentYear === today.getFullYear() && 
              currentMonth === today.getMonth() && 
              day === today.getDate();
          
          if (isToday) {
            dayCell.style.background = '#2C3E50';
            dayCell.style.color = '#fff';
            dayCell.style.fontWeight = '700';
            dayCell.style.border = '2px solid #2C3E50';
          }
          
          dayCell.addEventListener('mouseenter', () => {
            if (!isToday) {
              dayCell.style.background = '#e3f2fd';
            } else {
              dayCell.style.background = '#455a64';
              dayCell.style.color = '#fff';
            }
          });
          
          dayCell.addEventListener('mouseleave', () => {
            if (!isToday) {
              dayCell.style.background = '#fff';
            } else {
              dayCell.style.background = '#2C3E50';
              dayCell.style.color = '#fff';
            }
          });
          
          calendarGrid.appendChild(dayCell);
        }
      }
      
      prevBtn.addEventListener('click', () => {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        renderCalendar();
      });
      
      nextBtn.addEventListener('click', () => {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        renderCalendar();
      });
      
      // 초기 렌더링
      renderCalendar();
    })();
  </script>
  
  <script>
    // 월별 슬라이드 기능
    (() => {
      const slider = document.getElementById('scheduleSlider');
      const monthLabel = document.getElementById('currentMonth');
      const prevBtn = document.getElementById('prevMonth');
      const nextBtn = document.getElementById('nextMonth');
      
      const months = ['10–11월', '12–1월', '2월', '3–4월'];
      let currentIndex = 1; // 12-1월부터 시작 (현재 달)
      
      function updateSlider() {
        slider.style.transform = `translateX(-${currentIndex * 100}%)`;
        monthLabel.textContent = months[currentIndex];
      }
      
      prevBtn.addEventListener('click', () => {
        currentIndex--;
        if (currentIndex < 0) {
          currentIndex = months.length - 1;
        }
        updateSlider();
      });
      
      nextBtn.addEventListener('click', () => {
        currentIndex++;
        if (currentIndex >= months.length) {
          currentIndex = 0;
        }
        updateSlider();
      });
      
      // 초기 상태 설정
      updateSlider();
    })();
  </script>

  <!-- 사람별 필터 기능 -->
  <script>
    (() => {
      // 필터 버튼들과 테이블 행들 참조
      const filterBtns = document.querySelectorAll('.filter-btn');
      const allRows = document.querySelectorAll('.table tbody tr');
      
      filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          // 활성 버튼 변경 (하나만 선택 가능)
          filterBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          const selectedPerson = btn.dataset.person; // 선택된 사람 이름
          
          allRows.forEach(row => {
            const personCell = row.querySelector('td[data-person]');
            if (!personCell) return;
            
            const rowPerson = personCell.dataset.person;
            
            if (selectedPerson === 'all' || rowPerson === selectedPerson) {
              row.classList.remove('filtered-out');
            } else {
              row.classList.add('filtered-out');
            }
          });
        });
      });
    })();
  </script>
  
  <script src="../js/page-transitions.js"></script>
  
  <!-- 탭 버튼 스크롤 조정 - 제거됨 -->
  <script>
    // 페이지 로드 시 해시 제거하고 맨 위로 스크롤 (새로고침 시 처음부터 보이도록)
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    window.addEventListener('load', () => {
      if (window.location.hash) {
        history.replaceState(null, null, window.location.pathname);
      }
      window.scrollTo(0, 0);
    });
  </script>
</body>
</html>
